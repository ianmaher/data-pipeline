{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Template to create Pipeline",
    "Parameters": {
        "CodeStarConnectionArn": {
            "Type": "String",
            "Description": "Pre created and authorised codestar connection",
            "Default": "arn:aws:codestar-connections:eu-west-2:222910337455:connection/929a1690-421e-42f0-b676-eda21ea20aa2"
        },
        "FullRepositoryId": {
            "Type": "String",
            "Description": "The repo name of the system.",
            "Default": "ianmaher/data-pipeline"
        },
        "BranchName": {
            "Type": "String",
            "Description": "The branch of the repo to continuously deploy.",
            "Default": "develop"
        },
        "PipelineName": {
            "Description": "A name for pipeline",
            "Type": "String",
            "Default": "01_DP_dev"
        },
        "SourceBucket": {
            "Type": "String",
            "Description": "the name of the bucket that holds the lambda code",
            "Default": "spirit-data-pipeline-dev"
        },
        "EnvName": {
            "Type": "String",
            "Description": "Environment prefix e.g. dev",
            "Default": "dev"
        },
        "LogLevel": {
            "Type": "String",
            "Description": "LogLevel",
            "Default": "DEBUG"
        },
        "LogColours": {
            "Type": "String",
            "Description": "LogColours",
            "Default": "true"
        },
        "SSMParamInputsFileName": {
            "Description": "A input for file name for clloudformaiton inputs",
            "Type": "String",
            "Default": "ssm-params-ev.json"
        },
        "CFStackName": {
            "Description": "A name for CloudformationStack",
            "Type": "String",
            "Default": "DPDev"
        },
        "ArtifactStoreBucket": {
            "Description": "Bucket for Artifact store in London",
            "Type": "String",
            "Default": "codepipeline-artifactstore-dp-dev-eu-west-2"
        },
        "CFParamInputs": {
            "Type": "String",
            "Default": "dev.json"
        }
    },
    "Resources": {
        "CodeBuildServiceRole": {
            "Type": "AWS::IAM::Role",
            "Properties": {
                "Path": "/",
                "AssumeRolePolicyDocument": {
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "codebuild.amazonaws.com"
                                ]
                            },
                            "Action": [
                                "sts:AssumeRole"
                            ]
                        }
                    ]
                },
                "Policies": [
                    {
                        "PolicyName": "root",
                        "PolicyDocument": {
                            "Version": "2012-10-17",
                            "Statement": [
                                {
                                    "Resource": "*",
                                    "Effect": "Allow",
                                    "Action": [
                                        "logs:CreateLogGroup",
                                        "logs:CreateLogStream",
                                        "logs:CreateLogDelivery",
                                        "logs:PutLogEvents"
                                    ]
                                },
                                {
                                    "Resource": "*",
                                    "Effect": "Allow",
                                    "Action": [
                                        "s3:*"
                                    ]
                                },
                                {
                                    "Resource": {
                                        "Fn::Sub": "arn:aws:ssm:${AWS::Region}:${AWS::AccountId}:parameter/*"
                                    },
                                    "Effect": "Allow",
                                    "Action": [
                                        "ssm:GetParameters"
                                    ]
                                }
                            ]
                        }
                    }
                ]
            }
        },
        "CFNRole": {
            "Type": "AWS::IAM::Role",
            "Properties": {
                "AssumeRolePolicyDocument": {
                    "Statement": [
                        {
                            "Action": [
                                "sts:AssumeRole"
                            ],
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "cloudformation.amazonaws.com"
                                ]
                            }
                        }
                    ],
                    "Version": "2012-10-17"
                },
                "Path": "/",
                "Policies": [
                    {
                        "PolicyName": "CloudFormationRole",
                        "PolicyDocument": {
                            "Version": "2012-10-17",
                            "Statement": [
                                {
                                    "Sid": "VisualEditor0",
                                    "Effect": "Allow",
                                    "Action": "iam:CreateServiceLinkedRole",
                                    "Resource": {
                                        "Fn::Sub": "arn:aws:iam::${AWS::AccountId}:role/aws-service-role/elasticache.amazonaws.com/AWSServiceRoleForElastiCache"
                                    },
                                    "Condition": {
                                        "StringLike": {
                                            "iam:AWSServiceName": "elasticache.amazonaws.com"
                                        }
                                    }
                                },
                                {
                                    "Sid": "VisualEditor1",
                                    "Effect": "Allow",
                                    "Action": [
                                        "autoscaling:DescribeAccountLimits",
                                        "autoscaling:DescribeAdjustmentTypes",
                                        "autoscaling:DescribeAutoScalingGroups",
                                        "autoscaling:DescribeAutoScalingInstances",
                                        "autoscaling:DescribeAutoScalingNotificationTypes",
                                        "autoscaling:DescribeLaunchConfigurations",
                                        "autoscaling:DescribeLifecycleHooks",
                                        "autoscaling:DescribeLifecycleHookTypes",
                                        "autoscaling:DescribeLoadBalancers",
                                        "autoscaling:DescribeLoadBalancerTargetGroups",
                                        "autoscaling:DescribeMetricCollectionTypes",
                                        "autoscaling:DescribeNotificationConfigurations",
                                        "autoscaling:DescribePolicies",
                                        "autoscaling:DescribeScalingActivities",
                                        "autoscaling:DescribeScalingProcessTypes",
                                        "autoscaling:DescribeScheduledActions",
                                        "autoscaling:DescribeTags",
                                        "autoscaling:DescribeTerminationPolicyTypes",
                                        "cloudfront:*",
                                        "cloudwatch:DeleteAlarms",
                                        "cloudwatch:DescribeAlarms",
                                        "cloudwatch:GetMetricData",
                                        "cloudwatch:PutMetricAlarm",
                                        "cloudwatch:PutMetricData",
                                        "dynamodb:*",
                                        "ec2:*",
                                        "elasticache:*",
                                        "events:*",
                                        "iam:AddRoleToInstanceProfile",
                                        "iam:AttachGroupPolicy",
                                        "iam:AttachRolePolicy",
                                        "iam:AttachUserPolicy",
                                        "iam:CreateAccessKey",
                                        "iam:CreateInstanceProfile",
                                        "iam:CreatePolicy",
                                        "iam:CreatePolicyVersion",
                                        "iam:CreateServiceLinkedRole",
                                        "iam:CreateUser",
                                        "iam:DeleteAccessKey",
                                        "iam:DeleteGroupPolicy",
                                        "iam:DeleteInstanceProfile",
                                        "iam:DeletePolicy",
                                        "iam:DeletePolicyVersion",
                                        "iam:DeleteRolePolicy",
                                        "iam:DeleteServiceLinkedRole",
                                        "iam:DeleteUser",
                                        "iam:DeleteUserPolicy",
                                        "iam:DetachGroupPolicy",
                                        "iam:DetachRolePolicy",
                                        "iam:DetachUserPolicy",
                                        "iam:GetAccountSummary",
                                        "iam:GetGroupPolicy",
                                        "iam:GetInstanceProfile",
                                        "iam:GetLoginProfile",
                                        "iam:GetPolicy",
                                        "iam:GetPolicyVersion",
                                        "iam:GetRole",
                                        "iam:GetRolePolicy",
                                        "iam:GetSAMLProvider",
                                        "iam:GetServiceLastAccessedDetails",
                                        "iam:GetUser",
                                        "iam:GetUserPolicy",
                                        "iam:ListAccessKeys",
                                        "iam:ListAccountAliases",
                                        "iam:ListAttachedGroupPolicies",
                                        "iam:ListAttachedRolePolicies",
                                        "iam:ListAttachedUserPolicies",
                                        "iam:ListEntitiesForPolicy",
                                        "iam:ListGroupPolicies",
                                        "iam:ListGroups",
                                        "iam:ListGroupsForUser",
                                        "iam:ListInstanceProfiles",
                                        "iam:ListInstanceProfilesForRole",
                                        "iam:ListMFADevices",
                                        "iam:ListOpenIDConnectProviders",
                                        "iam:ListPolicies",
                                        "iam:ListPoliciesGrantingServiceAccess",
                                        "iam:ListPolicyVersions",
                                        "iam:ListRolePolicies",
                                        "iam:ListRoles",
                                        "iam:ListSAMLProviders",
                                        "iam:ListServerCertificates",
                                        "iam:ListServiceSpecificCredentials",
                                        "iam:ListSigningCertificates",
                                        "iam:ListSSHPublicKeys",
                                        "iam:ListUserPolicies",
                                        "iam:ListUsers",
                                        "iam:ListVirtualMFADevices",
                                        "iam:PassRole",
                                        "iam:PutGroupPolicy",
                                        "iam:PutRolePolicy",
                                        "iam:PutUserPolicy",
                                        "iam:RemoveRoleFromInstanceProfile",
                                        "iam:UpdateRole",
                                        "kms:CreateKey",
                                        "kms:ListAliases",
                                        "kms:ListKeys",
                                        "kms:PutKeyPolicy",
                                        "kms:ScheduleKeyDeletion",
                                        "rds:AddRoleToDBCluster",
                                        "rds:AddSourceIdentifierToSubscription",
                                        "rds:AddTagsToResource",
                                        "rds:ApplyPendingMaintenanceAction",
                                        "rds:CopyDBClusterSnapshot",
                                        "rds:CopyDBParameterGroup",
                                        "rds:CopyDBSnapshot",
                                        "rds:CopyOptionGroup",
                                        "rds:CreateDBCluster",
                                        "rds:CreateDBClusterParameterGroup",
                                        "rds:CreateDBClusterSnapshot",
                                        "rds:CreateDBInstance",
                                        "rds:CreateDBInstanceReadReplica",
                                        "rds:CreateDBParameterGroup",
                                        "rds:CreateDBSecurityGroup",
                                        "rds:CreateDBSnapshot",
                                        "rds:CreateDBSubnetGroup",
                                        "rds:CreateEventSubscription",
                                        "rds:CreateOptionGroup",
                                        "rds:DeleteDBCluster",
                                        "rds:DeleteDBClusterParameterGroup",
                                        "rds:DeleteDBClusterSnapshot",
                                        "rds:DeleteDBInstance",
                                        "rds:DeleteDBParameterGroup",
                                        "rds:DeleteDBSecurityGroup",
                                        "rds:DeleteDBSnapshot",
                                        "rds:DeleteDBSubnetGroup",
                                        "rds:DeleteEventSubscription",
                                        "rds:DeleteOptionGroup",
                                        "rds:DescribeAccountAttributes",
                                        "rds:DescribeCertificates",
                                        "rds:DescribeDBClusterParameterGroups",
                                        "rds:DescribeDBClusterParameters",
                                        "rds:DescribeDBClusters",
                                        "rds:DescribeDBClusterSnapshotAttributes",
                                        "rds:DescribeDBClusterSnapshots",
                                        "rds:DescribeDBEngineVersions",
                                        "rds:DescribeDBInstances",
                                        "rds:DescribeDBLogFiles",
                                        "rds:DescribeDBParameterGroups",
                                        "rds:DescribeDBParameters",
                                        "rds:DescribeDBSecurityGroups",
                                        "rds:DescribeDBSnapshotAttributes",
                                        "rds:DescribeDBSnapshots",
                                        "rds:DescribeDBSubnetGroups",
                                        "rds:DescribeEngineDefaultClusterParameters",
                                        "rds:DescribeEngineDefaultParameters",
                                        "rds:DescribeEventCategories",
                                        "rds:DescribeEvents",
                                        "rds:DescribeEventSubscriptions",
                                        "rds:DescribeOptionGroupOptions",
                                        "rds:DescribeOptionGroups",
                                        "rds:DescribeOrderableDBInstanceOptions",
                                        "rds:DescribePendingMaintenanceActions",
                                        "rds:DescribeReservedDBInstances",
                                        "rds:DescribeReservedDBInstancesOfferings",
                                        "rds:DescribeValidDBInstanceModifications",
                                        "rds:DownloadDBLogFilePortion",
                                        "rds:FailoverDBCluster",
                                        "rds:ListTagsForResource",
                                        "rds:ModifyCurrentDBClusterCapacity",
                                        "rds:ModifyDBCluster",
                                        "rds:ModifyDBClusterParameterGroup",
                                        "rds:ModifyDBClusterSnapshotAttribute",
                                        "rds:ModifyDBInstance",
                                        "rds:ModifyDBParameterGroup",
                                        "rds:ModifyDBSnapshotAttribute",
                                        "rds:ModifyDBSubnetGroup",
                                        "rds:ModifyEventSubscription",
                                        "rds:ModifyOptionGroup",
                                        "rds:PromoteReadReplica",
                                        "rds:PurchaseReservedDBInstancesOffering",
                                        "rds:RebootDBInstance",
                                        "rds:RemoveSourceIdentifierFromSubscription",
                                        "rds:RemoveTagsFromResource",
                                        "rds:ResetDBClusterParameterGroup",
                                        "rds:ResetDBParameterGroup",
                                        "rds:RestoreDBClusterFromSnapshot",
                                        "rds:RestoreDBClusterToPointInTime",
                                        "rds:RestoreDBInstanceFromDBSnapshot",
                                        "rds:RestoreDBInstanceToPointInTime",
                                        "rds:RevokeDBSecurityGroupIngress",
                                        "rds:StartDBCluster",
                                        "rds:StartDBInstance",
                                        "rds:StopDBCluster",
                                        "rds:StopDBInstance",
                                        "route53:*",
                                        "s3:*",
                                        "sns:CheckIfPhoneNumberIsOptedOut",
                                        "sns:CreatePlatformApplication",
                                        "sns:CreatePlatformEndpoint",
                                        "sns:DeleteEndpoint",
                                        "sns:DeletePlatformApplication",
                                        "sns:GetEndpointAttributes",
                                        "sns:GetPlatformApplicationAttributes",
                                        "sns:GetSMSAttributes",
                                        "sns:GetSubscriptionAttributes",
                                        "sns:ListEndpointsByPlatformApplication",
                                        "sns:ListPhoneNumbersOptedOut",
                                        "sns:ListPlatformApplications",
                                        "sns:ListSubscriptions",
                                        "sns:ListTopics",
                                        "sns:OptInPhoneNumber",
                                        "sns:SetEndpointAttributes",
                                        "sns:SetPlatformApplicationAttributes",
                                        "sns:SetSMSAttributes",
                                        "sns:SetSubscriptionAttributes",
                                        "sns:Unsubscribe",
                                        "sqs:*",
                                        "ssm:*",
                                        "waf:*",
                                        "xray:*"
                                    ],
                                    "Resource": "*"
                                },
                                {
                                    "Sid": "VisualEditor2",
                                    "Effect": "Allow",
                                    "Action": [
                                        "apigateway:*",
                                        "cloudformation:CreateChangeSet",
                                        "iam:CreateRole",
                                        "iam:DeleteRole",
                                        "iam:GetRole",
                                        "kms:CreateAlias",
                                        "kms:DeleteAlias",
                                        "kms:DescribeKey",
                                        "kms:GetKeyPolicy",
                                        "kms:GetKeyRotationStatus",
                                        "kms:GetParametersForImport",
                                        "kms:ListGrants",
                                        "kms:ListKeyPolicies",
                                        "kms:ListResourceTags",
                                        "kms:ListRetirableGrants",
                                        "kms:TagResource",
                                        "kms:UntagResource",
                                        "kms:UpdateAlias",
                                        "s3:PutObject"
                                    ],
                                    "Resource": [
                                        "arn:aws:cloudformation:eu-west-2:aws:transform/Serverless-2016-10-31",
                                        "arn:aws:kms:*:*:alias/*",
                                        "arn:aws:kms:*:*:key/*",
                                        "arn:aws:apigateway:eu-west-2::*",
                                        "arn:aws:apigateway:ap-southeast-1::*",
                                        "arn:aws:s3:::codepipeline*",
                                        {
                                            "Fn::Sub": "arn:aws:iam::${AWS::AccountId}:role/*"
                                        }
                                    ]
                                },
                                {
                                    "Sid": "VisualEditor3",
                                    "Effect": "Allow",
                                    "Action": [
                                        "iam:UpdateAssumeRolePolicy",
                                        "iam:DetachRolePolicy",
                                        "iam:AttachRolePolicy"
                                    ],
                                    "Resource": {
                                        "Fn::Sub": "arn:aws:iam::${AWS::AccountId}:role/*"
                                    }
                                },
                                {
                                    "Sid": "VisualEditor4",
                                    "Effect": "Allow",
                                    "Action": "autoscaling:*",
                                    "Resource": [
                                        "arn:aws:autoscaling:*:*:autoScalingGroup:*:autoScalingGroupName/*",
                                        "arn:aws:autoscaling:*:*:launchConfiguration:*:launchConfigurationName/*"
                                    ]
                                },
                                {
                                    "Sid": "VisualEditor5",
                                    "Effect": "Allow",
                                    "Action": "sns:*",
                                    "Resource": "arn:aws:sns:*:*:*"
                                },
                                {
                                    "Sid": "VisualEditor6",
                                    "Effect": "Allow",
                                    "Action": [
                                        "lambda:*",
                                        "logs:CreateLogGroup",
                                        "logs:CreateLogStream",
                                        "logs:CreateLogDelivery",
                                        "logs:PutLogEvents"
                                    ],
                                    "Resource": "*"
                                }
                            ]
                        }
                    }
                ]
            }
        },
        "PipelineRole": {
            "Type": "AWS::IAM::Role",
            "Properties": {
                "AssumeRolePolicyDocument": {
                    "Statement": [
                        {
                            "Action": [
                                "sts:AssumeRole"
                            ],
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "codepipeline.amazonaws.com"
                                ]
                            }
                        }
                    ],
                    "Version": "2012-10-17"
                },
                "Path": "/",
                "Policies": [
                    {
                        "PolicyName": "CodePipelineAccess",
                        "PolicyDocument": {
                            "Version": "2012-10-17",
                            "Statement": [
                                {
                                    "Action": [
                                        "s3:*",
                                        "cloudformation:*",
                                        "iam:PassRole",
                                        "sns:Publish",
                                        "lambda:*",
                                        "codebuild:*",
                                        "ssm:*"
                                    ],
                                    "Effect": "Allow",
                                    "Resource": "*"
                                }
                            ]
                        }
                    }
                ],
                "ManagedPolicyArns": [
                    "arn:aws:iam::aws:policy/service-role/AWSCodeStarServiceRole"
                ]
            }
        },
        "CodeBuildProject": {
            "Type": "AWS::CodeBuild::Project",
            "Properties": {
                "ServiceRole": {
                    "Ref": "CodeBuildServiceRole"
                },
                "Artifacts": {
                    "Type": "CODEPIPELINE"
                },
                "Environment": {
                    "Type": "LINUX_CONTAINER",
                    "ComputeType": "BUILD_GENERAL1_SMALL",
                    "Image": "aws/codebuild/amazonlinux2-x86_64-standard:2.0",
                    "EnvironmentVariables": [
                        {
                            "Name": "AccountNumberRef",
                            "Value": {
                                "Ref": "AWS::AccountId"
                            }
                        },
                        {
                            "Name": "SourceBucket",
                            "Value": {
                                "Ref": "SourceBucket"
                            }
                        },
                        {
                            "Name": "EnvName",
                            "Value": {
                                "Ref": "EnvName"
                            }
                        },
                        {
                            "Name": "LogLevel",
                            "Value": {
                                "Ref": "LogLevel"
                            }
                        },
                        {
                            "Name": "LogColours",
                            "Value": {
                                "Ref": "LogColours"
                            }
                        }
                    ]
                },
                "Source": {
                    "Type": "CODEPIPELINE",
                    "BuildSpec": "config/build/buildspec.yml"
                },
                "TimeoutInMinutes": 60,
                "Name": {
                    "Ref": "PipelineName"
                }
            }
        },
        "Pipeline": {
            "Type": "AWS::CodePipeline::Pipeline",
            "Properties": {
                "ArtifactStores": [
                    {
                        "ArtifactStore": {
                            "Location": {
                                "Ref": "ArtifactStoreBucket"
                            },
                            "Type": "S3"
                        },
                        "Region": {
                            "Ref": "AWS::Region"
                        }
                    }
                ],
                "DisableInboundStageTransitions": [],
                "Name": {
                    "Ref": "PipelineName"
                },
                "RoleArn": {
                    "Fn::GetAtt": [
                        "PipelineRole",
                        "Arn"
                    ]
                },
                "Stages": [
                    {
                        "Name": "Source",
                        "Actions": [
                            {
                                "Name": "CloudFormationGithub",
                                "Namespace": "Source",
                                "ActionTypeId": {
                                    "Version": "1",
                                    "Owner": "AWS",
                                    "Category": "Source",
                                    "Provider": "CodeStarSourceConnection"
                                },
                                "Configuration": {
                                    "ConnectionArn": {
                                        "Ref": "CodeStarConnectionArn"
                                    },
                                    "FullRepositoryId": {
                                        "Ref": "FullRepositoryId"
                                    },
                                    "BranchName": {
                                        "Ref": "BranchName"
                                    },
                                    "OutputArtifactFormat": "CODE_ZIP"
                                },
                                "OutputArtifacts": [
                                    {
                                        "Name": "SourceArtifact"
                                    }
                                ],
                                "RunOrder": 1
                            }
                        ]
                    },
                    {
                        "Name": "Build",
                        "Actions": [
                            {
                                "Name": "Build",
                                "InputArtifacts": [
                                    {
                                        "Name": "SourceArtifact"
                                    }
                                ],
                                "OutputArtifacts": [
                                    {
                                        "Name": "BuildArtifact"
                                    }
                                ],
                                "ActionTypeId": {
                                    "Category": "Build",
                                    "Owner": "AWS",
                                    "Version": "1",
                                    "Provider": "CodeBuild"
                                },
                                "Configuration": {
                                    "ProjectName": {
                                        "Ref": "CodeBuildProject"
                                    }
                                },
                                "RunOrder": 1
                            }
                        ]
                    },
                    {
                        "Name": "Ex-SSMParamLoader",
                        "Actions": [
                            {
                                "Name": "SSMParamLoader",
                                "ActionTypeId": {
                                    "Category": "Invoke",
                                    "Owner": "AWS",
                                    "Version": "1",
                                    "Provider": "Lambda"
                                },
                                "Configuration": {
                                    "FunctionName": "SSM-Adder",
                                    "UserParameters": {
                                        "Fn::Sub": "{\"Environment\":\"${EnvName}\",\"S3BucketName\":\"${SourceBucket}-${AWS::Region}\",\"ParamListS3ObjectPath\":\"configs/${SSMParamInputsFileName}\"}"
                                    }
                                },
                                "RunOrder": 1
                            }
                        ]
                    },
                    {
                        "Name": "Deploy",
                        "Actions": [
                            {
                                "Name": "DP-Create",
                                "Region": "eu-west-2",
                                "InputArtifacts": [
                                    {
                                        "Name": "BuildArtifact"
                                    }
                                ],
                                "ActionTypeId": {
                                    "Category": "Deploy",
                                    "Owner": "AWS",
                                    "Provider": "CloudFormation",
                                    "Version": "1"
                                },
                                "OutputArtifacts": [],
                                "Configuration": {
                                    "ActionMode": "CHANGE_SET_REPLACE",
                                    "RoleArn": {
                                        "Fn::GetAtt": [
                                            "CFNRole",
                                            "Arn"
                                        ]
                                    },
                                    "StackName": {
                                        "Fn::Sub": "${CFStackName}-1"
                                    },
                                    "ChangeSetName": {
                                        "Fn::Sub": "${CFStackName}-1"
                                    },
                                    "TemplateConfiguration": {
                                        "Fn::Sub": "BuildArtifact::pipeline-params/${CFParamInputs}"
                                    },
                                    "TemplatePath": "BuildArtifact::cf-templates/master.yml",
                                    "Capabilities": "CAPABILITY_IAM,CAPABILITY_NAMED_IAM,CAPABILITY_AUTO_EXPAND"
                                },
                                "RunOrder": 1
                            },
                            {
                                "Name": "DP-Execute",
                                "Region": "eu-west-2",
                                "InputArtifacts": [
                                    {
                                        "Name": "BuildArtifact"
                                    }
                                ],
                                "ActionTypeId": {
                                    "Category": "Deploy",
                                    "Owner": "AWS",
                                    "Provider": "CloudFormation",
                                    "Version": "1"
                                },
                                "OutputArtifacts": [
                                    {
                                        "Name": "DP-1-Region1"
                                    }
                                ],
                                "Configuration": {
                                    "ActionMode": "CHANGE_SET_EXECUTE",
                                    "RoleArn": {
                                        "Fn::GetAtt": [
                                            "CFNRole",
                                            "Arn"
                                        ]
                                    },
                                    "StackName": {
                                        "Fn::Sub": "${CFStackName}-1"
                                    },
                                    "ChangeSetName": {
                                        "Fn::Sub": "${CFStackName}-1"
                                    },
                                    "OutputFileName": "DeployArtifact"
                                },
                                "RunOrder": 2
                            }
                        ]
                    }
                ]
            }
        }
    }
}